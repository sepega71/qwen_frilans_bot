# Схема развертывания в облаке (Yandex Cloud)

## Общая информация

Данный документ описывает схему развертывания телеграм-бота для фрилансеров в облачной инфраструктуре Yandex Cloud. Схема включает в себя архитектуру, размещение компонентов, настройку безопасности и обеспечение соответствия требованиям законодательства РФ.

## Архитектура решения

### Общая схема

```
┌─────────────────────────────────────────────────────────┐
│                    YANDEX CLOUD                                 │
├─────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │   Load Balancer │  │   Application   │ │    Database     │  │
│  │                 │  │
│  │  (Cloud Load     │  │  (Kubernetes    │  │  (Managed      │  │
│  │   Balancer)     │  │   Cluster)      │  │   Service)      │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│              │                   │                   │          │
│              ▼                   ▼                   ▼          │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │   CDN (Cloud    │  │   Bot Service   │  │   Redis Cache   │  │
│  │   CDN)          │  │   (Containers)  │  │   (Managed      │  │
│  │                 │  │   Service)      │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│              │                   │                   │          │
│              ▼                   ▼                   ▼          │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                Object Storage (S3-compatible)               ││
│  │                    (Backups, Logs)                          ││
│  └─────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────┘
```

### Компоненты архитектуры

1. **Cloud Load Balancer** - распределение нагрузки между экземплярами приложения
2. **Kubernetes Cluster** - оркестрация контейнеров с приложением
3. **Managed Service for Kubernetes (MK8s)** - управляемый кластер Kubernetes
4. **Virtual Machines** - для размещения специфических компонентов
5. **Managed Service for PostgreSQL** - управляемая база данных
6. **Managed Service for Redis** - кэширование данных
7. **Object Storage** - хранение резервных копий и логов
8. **Cloud CDN** - доставка статического контента
9. **Cloud Monitoring** - мониторинг инфраструктуры
10. **Cloud Logging** - централизованное логирование

## Подробная архитектура

### 1. Слой доступа (Access Layer)

#### Cloud Load Balancer
- **Тип**: Network Load Balancer
- **Назначение**: Распределение трафика между экземплярами приложения
- **Конфигурация**:
  - Health checks для проверки доступности сервисов
 - SSL-терминация для шифрования трафика
  - DDoS-защита от Yandex Cloud

#### Cloud CDN
- **Назначение**: Кэширование и доставка статических ресурсов
- **Конфигурация**:
  - Origin server: Load Balancer
  - TTL: 1 час для статических файлов
  - HTTPS: включен

### 2. Слой приложения (Application Layer)

#### Managed Service for Kubernetes (MK8s)
- **Версия**: Kubernetes 1.24+
- **Конфигурация**:
  - 3 управляющих узла (master nodes) для отказоустойчивости
  - 3 рабочих узла (worker nodes) начально, с возможностью autoscaling
  - Node pool: auto scale от 3 до 10 узлов
  - Поддержка GPU-инстансов (при необходимости)

#### Контейнеры приложения
- **Bot Service**: Основной сервис бота
- **Data Collection Service**: Сбор данных из источников
- **Notification Service**: Отправка уведомлений
- **API Gateway**: Управление API-запросами

### 3. Слой данных (Data Layer)

#### Managed Service for PostgreSQL
- **Версия**: PostgreSQL 14
- **Конфигурация**:
  - Выделенные ресурсы: 4 vCPU, 16 ГБ RAM
 - Хранилище: SSD, 500 ГБ
  - Репликация: master-slave
  - Резервное копирование: ежедневное, хранение 7 дней
  - Географическое размещение: только в РФ (Москва, Санкт-Петербург)

#### Managed Service for Redis
- **Назначение**: Кэширование данных и сессий
- **Конфигурация**:
  - Выделенные ресурсы: 2 vCPU, 8 ГБ RAM
 - Хранилище: 100 ГБ
  - Репликация: включена
  - Persistence: включено

### 4. Слой хранения (Storage Layer)

#### Object Storage
- **Назначение**: Хранение резервных копий, логов, временных файлов
- **Конфигурация**:
  - S3-совместимое хранилище
  - Шифрование: Server-side encryption
  - Класс хранения: Standard
  - Жизненный цикл: автоматическая очистка старше 30 дней

## Безопасность

### Сетевая безопасность
- **VPC**: Изолированная виртуальная сеть
- **Subnets**: Отдельные подсети для каждого слоя
- **Security Groups**: Ограничение доступа между компонентами
- **NAT Gateway**: Защита внутренних сервисов

### Аутентификация и авторизация
- **IAM**: Управление доступом через Identity and Access Management
- **Service Accounts**: Для взаимодействия между сервисами
- **Key Management Service**: Управление криптографическими ключами

### Шифрование
- **Data at rest**: Шифрование дисков и баз данных
- **Data in transit**: Шифрование TLS для всех соединений
- **Key Management**: Yandex KMS для управления ключами

## Соответствие требованиям РФ

### Хранение данных
- **Географическое размещение**: Все данные хранятся на территории РФ
- **Сертификация**: Использование сертифицированных в РФ облачных сервисов
- **Резервное копирование**: Копии данных также находятся в РФ

### Криптография
- **Алгоритмы**: Использование криптографических алгоритмов, разрешенных в РФ
- **Сертификация**: Применение сертифицированных криптопровайдеров

## Мониторинг и логирование

### Cloud Monitoring
- **Метрики**: CPU, RAM, disk usage, network traffic
- **Алерты**: Уведомления о критических значениях
- **Дашборды**: Визуализация состояния системы

### Cloud Logging
- **Сбор логов**: Из всех компонентов системы
- **Анализ**: Поиск и фильтрация логов
- **Хранение**: 30 дней в системе, затем архивирование

## План развертывания

### Этап 1: Подготовка инфраструктуры (дни 1-3)

1. Создание облака и каталога в Yandex Cloud
2. Настройка учетной записи и прав доступа
3. Создание VPC и подсетей
4. Настройка безопасности и брандмауэра

### Этап 2: Развертывание баз данных (дни 4-5)

1. Создание Managed Service for PostgreSQL
2. Создание Managed Service for Redis
3. Настройка репликации и резервного копирования
4. Тестирование подключения

### Этап 3: Настройка Kubernetes (дни 6-8)

1. Создание Managed Service for Kubernetes
2. Настройка node pools
3. Установка ingress-контроллера
4. Настройка сетевых политик

### Этап 4: Развертывание приложения (дни 9-11)

1. Настройка CI/CD pipeline для деплоя в облако
2. Развертывание основных сервисов
3. Настройка Load Balancer
4. Тестирование работоспособности

### Этап 5: Настройка безопасности и мониторинга (дни 12-14)

1. Настройка Cloud Monitoring
2. Настройка Cloud Logging
3. Настройка резервного копирования
4. Тестирование отказоустойчивости

## Масштабирование

### Горизонтальное масштабирование
- **Kubernetes HPA**: Автоматическое масштабирование по CPU и RAM
- **Load Balancer**: Распределение нагрузки между экземплярами
- **Database Read Replicas**: Для увеличения пропускной способности чтения

### Вертикальное масштабирование
- **Увеличение ресурсов**: При необходимости увеличение vCPU и RAM
- **Увеличение хранилища**: Расширение дискового пространства

## Резервное копирование и восстановление

### Регулярное резервное копирование
- **PostgreSQL**: Ежедневные бэкапы, хранение 7 дней
- **Redis**: Бэкапы снапшотов
- **Object Storage**: Хранение архивных данных

### План восстановления
- **Данные**: Восстановление из бэкапов PostgreSQL
- **Конфигурация**: Использование Infrastructure as Code (Terraform)
- **Службы**: Автоматическое восстановление через Kubernetes

## Стоимость

### Ориентировочная стоимость (ежемесячно)
- **Kubernetes**: ~15,00 руб
- **PostgreSQL**: ~8,000 руб
- **Redis**: ~3,000 руб
- **Load Balancer**: ~2,00 руб
- **Object Storage**: ~1,000 руб
- **CDN**: ~500 руб
- **Мониторинг**: ~1,000 руб
- **Всего**: ~30,500 руб (начальный уровень)

## Заключение

Схема развертывания в Yandex Cloud обеспечивает:
- Высокую доступность и отказоустойчивость
- Масштабируемость под нагрузку
- Соответствие требованиям законодательства РФ
- Безопасность и защиту данных
- Эффективный мониторинг и логирование